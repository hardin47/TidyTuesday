---
title: "Diwali Sales Data"
author: "Jo Hardin"
date: "11/14/2023"
format: html
execute:
  warning: false
  message: false
---


```{r}
library(tidyverse) # ggplot, lubridate, dplyr, stringr, readr...
library(tidytext)
library(praise)
library(paletteer)
library(ggforce)
library(networkD3)
```



# The Data

The data this week comes from [sales data](https://www.kaggle.com/datasets/saadharoon27/diwali-sales-dataset) for a retail store during the Diwali festival period in India. The data is shared on Kaggle by Saad Haroon. It isn't clear how the data were obtained, including the personal characteristics.  ???

```{r}
diwali <- read_csv("diwali_sales_data.csv") |>
  janitor::clean_names() |>
  mutate(marital_status = as.factor(marital_status))
```

```{r}
diwali |>
  group_by(product_category) |>
  summarize(number = n()) |>
  arrange(desc(number))
```



```{r}
diwali |>
  group_by(age_group,gender, marital_status) |>
  summarize(ave_amount = mean(amount, na.rm = TRUE)) |>
  ggplot(aes(x = age_group)) + 
  geom_bar() + 
  facet_wrap(gender ~ marital_status)

diwali |>
  filter(age < 20) |>
  ggplot(aes(x = age, y = amount, color = occupation)) +
  geom_point()

diwali |>
  ggplot(aes(x = product_category, y = amount, color = marital_status)) +
  geom_boxplot(position = position_dodge(width = 0.75)) + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  ylim(c(10000,25000))
```


```{r}
diwali |>
  group_by(state) |>
  summarize(number = n()) |>
  arrange(desc(number))
```


Making a Sankey plot to identify whether there are occupation trends across different regions.  I'm slightly confused about the relationship between zone and state as I would have thought the state would be entirely contained in a particular zone.  Regardless, the occupations do not seem to differ across the different states or regions.

```{r}
#| fig-width: 10
#| fig-height: 10
#| fig-alt: Sankey plot showing how zone feeds into state which feeds into occupation. We can see that, for the most part, each state comes from a particular zone.  However, there are lines that connect each state to each region, which doesn't make sense to me.  Each of the occupations seems to come equally from each of the states.
#| fig-cap: Sankey plot showing how zone feeds into state which feeds into occupation.

diwali_table <- diwali |>
  filter(occupation %in% c("IT Sector", "Healthcare", "Aviation", "Banking",
                           "Govt", "Hospitality", "Media", "Automobile")) |>
  filter(state %in% c("Uttar Pradesh", "Maharashtra", "Karnataka", "Delhi",
                      "Madhya Pradesh", "Andhra Pradesh", "Himachal Pradesh")) |>
  select(zone, state, occupation) |>
  table()

data <- reshape2::melt(diwali_table)
data <- gather_set_data(data, 1:3) |>
  mutate(x = as.factor(x))

data |>
  mutate(x = fct_recode(x, "zone" = "1", "state" = "2", "occupation" = "3")) |>
ggplot(aes(x, id = id, split = y, value = value)) +
  geom_parallel_sets(aes(color = zone, fill = zone), alpha = 0.3, sep = 0.8) +
  geom_parallel_sets_axes(color = "lightgrey", fill = "white",
                          sep = 0.8, 
                          axis.width = c(rep(0.1, 4), rep(0.6, 7), rep(0.1, 8))) +
  geom_parallel_sets_labels(angle = c(rep(0, 4), rep(0, 15)), sep = 0.8, 
                            position = position_nudge(c(rep(-.3, 4), rep(0.01, 7),
                                                        rep(.3, 8))),

                            axis.width = c(rep(0.1, 4), rep(0.6, 7), rep(0.1, 8))) +
  theme(legend.position = "none", axis.title.y = element_blank(), 
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank()) +
  xlab("") +
  labs(title = "Zone to State to Occupation",
       caption = "Data credit: @Saad Haroon")


```





```{r}
praise()
```



