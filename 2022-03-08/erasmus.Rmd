---
title: "Erasmus Study Abroad"
author: "Jo Hardin"
date: "3/8/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, 
                      warning = FALSE, cache = TRUE,
                      eval.after = 'fig.cap', fig.width = 10, fig.height = 6)
library(tidyverse)
library(tidymodels)
library(janitor)
library(viridis)
library(patchwork)
library(knitr)
library(skimr)
library(ggrepel)
library(lubridate)
library(plotly)
library(countrycode)

library(praise)
set.seed(4747)
```


## The Data

The data this week comes from [Data.Europa](https://data.europa.eu/data/datasets?locale=en&catalog=eac&query=erasmus&page=1&sort=issued%2Bdesc,%20relevance%2Bdesc,%20title.en%2Basc) hattip to [Data is Plural](https://www.data-is-plural.com/archive/2022-02-09-edition/).

Wimdu wrote a short [blog post](https://www.wimdu.co.uk/blog/discover-popular-erasmus-destinations) on the most popular ERASMUS destinations.

```{r}
erasmus <- read_csv("erasmus.csv") %>%
  mutate(send = countrycode(sending_country_code,
                                       origin =  'iso2c', 
                                       destination = 'country.name')) %>%
  mutate(send = case_when(
    sending_country_code == "EL" ~ "Greece",
    sending_country_code == "UK" ~ "UK",
    sending_country_code == "XK" ~ "Kosovo",
    TRUE ~ send
  )) %>%
  mutate(receive = countrycode(receiving_country_code,
                                       origin =  'iso2c', 
                                       destination = 'country.name')) %>%
  mutate(receive = case_when(
    receiving_country_code == "EL" ~ "Greece",
    receiving_country_code == "UK" ~ "UK",
    receiving_country_code == "XK" ~ "Kosovo",
    TRUE ~ receive
  ))

mobility <- read_csv("mobility.csv")
```

## Wrangling


```{r}
erasmus_country <- erasmus %>%
  select(academic_year, participant_gender, send, receive,
         participants, special_needs) %>%
  pivot_longer(cols = send:receive, names_to = "how", values_to = "country") %>%
  group_by(country, how, special_needs, participant_gender, academic_year) %>%
  summarize(total = sum(participants))
  
```

I was hoping to do more with this plot (including ordering, segmenting the barplots, etc.).  Alas, gotta be done for now!

```{r}
erasmus_country %>%
  filter(total > 100) %>%
  mutate(total = ifelse(how == "send", -total, total)) %>%  ggplot() + 
  geom_bar(aes(x = country, y = total, fill = participant_gender), stat = "identity") + 
  geom_hline(yintercept = 0) + 
  coord_flip() + 
  scale_fill_viridis_d()
```
Some odd data characteristics... how is the age -7184 years?  or 1049 years?

```{r}
erasmus %>%
  select(participant_age) %>%
  summary()
```

I'm also not totally sure what a single row represents.  It seems like it means a particular combination of demographic characteristics.  But are there really 17 participants with the same demographic characteristics which would make up a single row? 

```{r}
erasmus %>%
  filter(special_needs == "Yes") %>%
  select(special_needs, participants) %>%
  table()
```


