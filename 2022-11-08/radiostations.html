<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.256">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jo Hardin">
<meta name="dcterms.date" content="2022-11-15">

<title>Radio Stations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="radiostations_files/libs/clipboard/clipboard.min.js"></script>
<script src="radiostations_files/libs/quarto-html/quarto.js"></script>
<script src="radiostations_files/libs/quarto-html/popper.min.js"></script>
<script src="radiostations_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="radiostations_files/libs/quarto-html/anchor.min.js"></script>
<link href="radiostations_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="radiostations_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="radiostations_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="radiostations_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="radiostations_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Radio Stations</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jo Hardin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 15, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-context="setup">

</div>
<section id="shiny-practice" class="level2">
<h2 class="anchored" data-anchor-id="shiny-practice">Shiny Practice</h2>
<p>Trying to build on my quarto practicing to get used to Shiny. The following app works in Shiny, but it is too big to deploy for free on the Shiny server, so no link to connect too. Next time I’m going to try something smaller!</p>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>The data this week comes from <a href="https://en.wikipedia.org/wiki/Lists_of_radio_stations_in_the_United_States">Wikipedia</a>.</p>
<p>Today’s analysis is based on <a href="https://github.com/TorviciaND/TidyTuesday">work</a> from <a href="https://twitter.com/NdFest/status/1591803647520018432"><span class="citation" data-cites="NdFest">@NdFest</span></a>.</p>
<p>The goal is to recreate their map but then to change the circles using a Shiny App to switch from public radio to other types of radio (religious, pop, country, etc.)/</p>
<div class="cell" data-context="data">

</div>
<section id="countour-cleaning" class="level4">
<h4 class="anchored" data-anchor-id="countour-cleaning">Countour cleaning</h4>
<p>Directly from the Tidy Tuesday website</p>
<div class="cell" data-context="data" data-hash="radiostations_cache/html/unnamed-chunk-3_6ab1d5cb2ab0f96649ccdf07d16bb9b2">

</div>
<p>Getting info on the call signs of the individual radio stations.</p>
<div class="cell" data-hash="radiostations_cache/html/unnamed-chunk-4_bfd62c1b3b0f3dfbb526f81d33f79786">

</div>
<div class="cell" data-context="data">

</div>
</section>
</section>
<section id="plotting" class="level2">
<h2 class="anchored" data-anchor-id="plotting">Plotting</h2>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-right">
<div class="panel-fill g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="cell">
<div class="cell-output-display">
<p><img src="radiostations_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="radiostations_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div class="cell panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="dataset-label" for="dataset">Choose dataset</label>
<div>
<select id="dataset"><option value="public" selected="">public</option>
<option value="country">country</option>
<option value="rock">rock</option>
<option value="religious">religious</option>
<option value="Spanish">Spanish</option>
<option value="classic">classic</option>
<option value="top 40">top 40</option></select>
<script type="application/json" data-for="dataset" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div id="distPlot" class="shiny-plot-output" style="width:100%;height:400px;"></div>
</div>
</div>
</div>
<div class="cell" data-context="server">

</div>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
library(tidyverse)
library(readr)
library(rvest)
library(purrr)
library(janitor)
library(ggmap)
</script>
 
<script type="application/shiny-prerendered" data-context="data">
station_info <- read_csv("station_info.csv")
state_stations <- read_csv("state_stations.csv") %>%
  right_join(station_info, by = c("call_sign")) %>%
  mutate(format = tolower(format))

#This file needs to be downloaded to your computer and unzipped
raw_contour <- read_delim("FM_service_contour_current.txt",  delim = "|")

#Getting just the stations that include Public in their format
public_stations <- state_stations %>% 
  filter(grepl("public", format))

country_stations <- state_stations %>%
  filter(grepl("country", format))

rock_stations <- state_stations %>%
  filter(grepl("rock", format))

religious_stations <- state_stations %>%
  filter(grepl("religious", format) | grepl("worship", format) | grepl("christian", format))

spanish_stations <- state_stations %>%
  filter(grepl("spanish", format) | grepl("mexic", format))

classic_stations <- state_stations %>%
  filter(grepl("classic", format))

top40_stations <- state_stations %>%
  filter(grepl("40", format))
</script>
 
<script type="application/shiny-prerendered" data-context="data">
application_id <- read_csv("application_id.csv")

public_stations <- public_stations %>% 
  left_join(application_id, by = "call_sign") %>%
  left_join(lng_contour, by = "application_id") %>%
  drop_na() %>%  
  mutate(deg_lat = as.numeric(deg_lat),
         deg_lng = as.numeric(deg_lng),
         site_lat = as.numeric(site_lat),
         site_long = as.numeric(site_long))

country_stations <- country_stations %>% 
  left_join(application_id, by = "call_sign") %>%
  left_join(lng_contour, by = "application_id") %>%
  drop_na() %>%  
  mutate(deg_lat = as.numeric(deg_lat),
         deg_lng = as.numeric(deg_lng),
         site_lat = as.numeric(site_lat),
         site_long = as.numeric(site_long))

rock_stations <- rock_stations %>% 
  left_join(application_id, by = "call_sign") %>%
  left_join(lng_contour, by = "application_id") %>%
  drop_na() %>%  
  mutate(deg_lat = as.numeric(deg_lat),
         deg_lng = as.numeric(deg_lng),
         site_lat = as.numeric(site_lat),
         site_long = as.numeric(site_long))

religious_stations <- religious_stations %>% 
  left_join(application_id, by = "call_sign") %>%
  left_join(lng_contour, by = "application_id") %>%
  drop_na() %>%  
  mutate(deg_lat = as.numeric(deg_lat),
         deg_lng = as.numeric(deg_lng),
         site_lat = as.numeric(site_lat),
         site_long = as.numeric(site_long))

top40_stations <- top40_stations %>% 
  left_join(application_id, by = "call_sign") %>%
  left_join(lng_contour, by = "application_id") %>%
  drop_na() %>%  
  mutate(deg_lat = as.numeric(deg_lat),
         deg_lng = as.numeric(deg_lng),
         site_lat = as.numeric(site_lat),
         site_long = as.numeric(site_long))

spanish_stations <- spanish_stations %>% 
  left_join(application_id, by = "call_sign") %>%
  left_join(lng_contour, by = "application_id") %>%
  drop_na() %>%  
  mutate(deg_lat = as.numeric(deg_lat),
         deg_lng = as.numeric(deg_lng),
         site_lat = as.numeric(site_lat),
         site_long = as.numeric(site_long))

classic_stations <- classic_stations %>% 
  left_join(application_id, by = "call_sign") %>%
  left_join(lng_contour, by = "application_id") %>%
  drop_na() %>%  
  mutate(deg_lat = as.numeric(deg_lat),
         deg_lng = as.numeric(deg_lng),
         site_lat = as.numeric(site_lat),
         site_long = as.numeric(site_long))

my_map <- ggmap::get_stamenmap(bbox=c(left=-125,bottom=25,right=-67,top=49),
                        zoom=3, maptype="toner-lite")

</script>
 
<script type="application/shiny-prerendered" data-context="server">
radio_data <- reactive({
  switch(input$dataset,
         "public" = public_stations,
         "country" = country_stations,
         "rock" = rock_stations, 
         "religious" = religious_stations, 
         "Spanish" = spanish_stations, 
         "classic" = classic_stations, 
         "top 40" = top40_stations)
})

output$distPlot <- renderPlot({

ggmap::ggmap(my_map)+
  geom_point(data = radio_data(),
             aes(x = deg_lng, y = deg_lat),
             size=0.25,color="darkslategray3") +
  labs(title = "Radio Stations in the Continental United States", 
               x = "", y = "") +
  theme(plot.title = element_text(size = 13, hjust = 0.5),
        axis.text = element_blank(),
        axis.ticks = element_blank())
})
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.12.4"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.7.2"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->

<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97]}},"value":[{"type":"character","attributes":{},"value":["assertthat","backports","base","bit","bit64","bitops","broom","bslib","cachem","cellranger","cli","colorspace","compiler","crayon","curl","datasets","DBI","dbplyr","digest","dplyr","ellipsis","evaluate","fansi","farver","fastmap","forcats","fs","generics","ggmap","ggplot2","glue","graphics","grDevices","grid","gtable","haven","hms","htmltools","htmlwidgets","httpuv","httr","janitor","jpeg","jquerylib","jsonlite","knitr","labeling","later","lattice","lifecycle","lubridate","magrittr","memoise","methods","mime","modelr","munsell","parallel","pillar","pkgconfig","plyr","png","promises","purrr","R6","Rcpp","readr","readxl","reprex","RgoogleMaps","rlang","rmarkdown","rstudioapi","rvest","sass","scales","shiny","snakecase","sp","stats","stringi","stringr","tibble","tidyr","tidyselect","tidyverse","tools","tzdb","utf8","utils","vctrs","vroom","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["0.2.1","1.4.1","4.2.0","4.0.4","4.0.5","1.0-7","1.0.1","0.4.0","1.0.6","1.1.0","3.3.0","2.0-3","4.2.0","1.5.1","4.3.2","4.2.0","1.1.2","2.2.0","0.6.29","1.0.9","0.3.2","0.15","1.0.3","2.1.1","1.1.0","0.5.1","1.5.2","0.1.3","3.0.1","3.3.6","1.6.2","4.2.0","4.2.0","4.2.0","0.3.0","2.5.0","1.1.1","0.5.3","1.5.4","1.6.5","1.4.3","2.1.0","0.1-9","0.1.4","1.8.0","1.39","0.4.2","1.3.0","0.20-45","1.0.1","1.8.0","2.0.3","2.0.1","4.2.0","0.12","0.1.8","0.5.0","4.2.0","1.8.0","2.0.3","1.8.7","0.1-7","1.2.0.1","0.3.4","2.5.1","1.0.9","2.1.2","1.4.0","2.0.1","1.4.5.3","1.0.4","2.14","0.13","1.0.2","0.4.2","1.2.0","1.7.2","0.11.0","1.5-0","4.2.0","1.7.8","1.4.0","3.1.8","1.2.0","1.1.2","1.3.1","4.2.0","0.3.0","1.2.2","4.2.0","0.4.1","1.5.7","2.5.0","0.31","1.3.3","1.8-4","2.3.5"]}]}]}
</script>
<!--/html_preserve-->
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>